{
  "entities": {
    "Company": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Company",
      "type": "object",
      "description": "Represents an organizational company, such as Alpha or Charlie Company, involved in operations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Company entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the company (e.g., \"Alpha Company\")."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "UnitType": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UnitType",
      "type": "object",
      "description": "Defines the type of an operational unit (e.g., DPU, SIF, TRS).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UnitType entity."
        },
        "name": {
          "type": "string",
          "description": "The abbreviated or common name of the unit type (e.g., \"DPU\", \"SIF\")."
        },
        "description": {
          "type": "string",
          "description": "A full description of the unit type (e.g., \"District Police Unit\", \"Special Intervention Force\")."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "OperationalUnit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OperationalUnit",
      "type": "object",
      "description": "Represents a specific operational location or specialized unit where activities are conducted (e.g., Gasabo DPU, SIF).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OperationalUnit entity."
        },
        "name": {
          "type": "string",
          "description": "The specific name of the operational unit (e.g., \"Gasabo\", \"Kicukiro\", \"SIF\")."
        },
        "unitTypeId": {
          "type": "string",
          "description": "Reference to UnitType. (Relationship: UnitType 1:N OperationalUnit)"
        },
        "locationDetail": {
          "type": "string",
          "description": "Specific geographical or administrative detail of the unit's location (e.g., \"Gasabo District\")."
        }
      },
      "required": [
        "id",
        "name",
        "unitTypeId"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "The main entity for a daily, weekly, or custom period report, aggregating information from various operational units, challenges, recommendations, and other activities.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Report entity."
        },
        "reportType": {
          "type": "string",
          "description": "Type of report (e.g., \"Daily\", \"Weekly\", \"Custom\")."
        },
        "reportDate": {
          "type": "string",
          "description": "The specific date the report refers to (for daily reports).",
          "format": "date-time"
        },
        "periodStartDate": {
          "type": "string",
          "description": "The start date of the reporting period (for weekly or custom reports).",
          "format": "date-time"
        },
        "periodEndDate": {
          "type": "string",
          "description": "The end date of the reporting period (for weekly or custom reports).",
          "format": "date-time"
        },
        "titleHeader": {
          "type": "string",
          "description": "The general title header of the report (e.g., \"General daily report for cadets intake 14/2025-2026 Attachments operations\")."
        },
        "cadetIntakeReference": {
          "type": "string",
          "description": "The cadet intake period reference (e.g., \"14/2025-2026\")."
        },
        "overallSecuritySituation": {
          "type": "string",
          "description": "A summary of the overall security situation across all operations."
        },
        "commanderName": {
          "type": "string",
          "description": "The name of the officer submitting the report (e.g., \"Oc Isiah KAYIRANGA\")."
        },
        "commanderRank": {
          "type": "string",
          "description": "The rank or role of the officer submitting the report (e.g., \"Cadet Commander\")."
        },
        "companyOperationReportIds": {
          "type": "array",
          "description": "References to CompanyOperationReport entities included in this report. (Relationship: Report 1:N CompanyOperationReport)",
          "items": {
            "type": "string"
          }
        },
        "challengeIds": {
          "type": "array",
          "description": "References to Challenge entities associated with this report. (Relationship: Report 1:N Challenge)",
          "items": {
            "type": "string"
          }
        },
        "recommendationIds": {
          "type": "array",
          "description": "References to Recommendation entities associated with this report. (Relationship: Report 1:N Recommendation)",
          "items": {
            "type": "string"
          }
        },
        "otherActivityIds": {
          "type": "array",
          "description": "References to OtherActivity entities associated with this report. (Relationship: Report 1:N OtherActivity)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the report was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the report was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "reportType",
        "titleHeader",
        "cadetIntakeReference",
        "commanderName",
        "commanderRank",
        "createdAt",
        "updatedAt"
      ]
    },
    "CompanyOperationReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CompanyOperationReport",
      "type": "object",
      "description": "Details the operations conducted by a specific company within an operational unit for a given report.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CompanyOperationReport entity."
        },
        "reportId": {
          "type": "string",
          "description": "Reference to the parent Report. (Relationship: Report 1:N CompanyOperationReport)"
        },
        "operationalUnitId": {
          "type": "string",
          "description": "Reference to the OperationalUnit where operations took place. (Relationship: OperationalUnit 1:N CompanyOperationReport)"
        },
        "companyId": {
          "type": "string",
          "description": "Reference to the Company involved in the operations. (Relationship: Company 1:N CompanyOperationReport)"
        },
        "sectionHeader": {
          "type": "string",
          "description": "The header for this specific section of the report (e.g., \"GASABO DPU DAY ONE REPORT\")."
        },
        "operationStartTime": {
          "type": "string",
          "description": "The start time of the operations (e.g., \"0600hrs\")."
        },
        "operationEndTime": {
          "type": "string",
          "description": "The end time of the operations (e.g., \"1900hrs\")."
        },
        "securitySituation": {
          "type": "string",
          "description": "The security situation reported for this unit's area of operation."
        },
        "activitiesDescription": {
          "type": "string",
          "description": "A general description of the activities conducted."
        },
        "keyEmphasisPoints": {
          "type": "array",
          "description": "An array of strings detailing important points or topics emphasized during activities or introductions.",
          "items": {
            "type": "string"
          }
        },
        "conductingOfficerName": {
          "type": "string",
          "description": "The name of the officer who conducted briefings or introductions."
        },
        "conductingOfficerRole": {
          "type": "string",
          "description": "The role of the officer who conducted briefings or introductions (e.g., \"DPC Kicukiro\", \"Operations Commander\")."
        },
        "patrolAreas": {
          "type": "array",
          "description": "An array of strings describing areas where patrols were conducted (e.g., \"Giporoso (vehicle and foot patrol)\").",
          "items": {
            "type": "string"
          }
        },
        "deploymentDescription": {
          "type": "string",
          "description": "Description of deployment details."
        },
        "additionalNotes": {
          "type": "string",
          "description": "Any free-form additional notes for this specific company's operation report."
        },
        "caseReportSummaryIds": {
          "type": "array",
          "description": "References to CaseReportSummary entities for cases reported within this operational unit. (Relationship: CompanyOperationReport 1:N CaseReportSummary)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "reportId",
        "operationalUnitId",
        "companyId",
        "sectionHeader",
        "securitySituation"
      ]
    },
    "CaseReportSummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CaseReportSummary",
      "type": "object",
      "description": "Summarizes cases reported at a specific post within an operational unit, including the total number of cases and breakdown by type.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CaseReportSummary entity."
        },
        "companyOperationReportId": {
          "type": "string",
          "description": "Reference to the parent CompanyOperationReport. (Relationship: CompanyOperationReport 1:N CaseReportSummary)"
        },
        "postName": {
          "type": "string",
          "description": "The name of the post where cases were received (e.g., \"Nyabugogo Post\", \"Inkundamahoro Post\")."
        },
        "totalCasesCount": {
          "type": "number",
          "description": "The total number of cases reported at this post."
        },
        "caseTypeCountIds": {
          "type": "array",
          "description": "References to CaseTypeCount entities for the specific types of cases. (Relationship: CaseReportSummary 1:N CaseTypeCount)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "companyOperationReportId",
        "postName",
        "totalCasesCount"
      ]
    },
    "CaseTypeCount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CaseTypeCount",
      "type": "object",
      "description": "Details the count for a specific type of case reported at a post, including any recovery information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CaseTypeCount entity."
        },
        "caseReportSummaryId": {
          "type": "string",
          "description": "Reference to the parent CaseReportSummary. (Relationship: CaseReportSummary 1:N CaseTypeCount)"
        },
        "caseType": {
          "type": "string",
          "description": "The type of case (e.g., \"Theft\", \"Street vending\", \"Breach of trust\")."
        },
        "count": {
          "type": "number",
          "description": "The number of occurrences for this specific case type."
        },
        "recoveryDetails": {
          "type": "string",
          "description": "Additional details about recovered items related to the case type (e.g., \"101 cases of substandard home-brewed drinks recovered\")."
        }
      },
      "required": [
        "id",
        "caseReportSummaryId",
        "caseType",
        "count"
      ]
    },
    "Challenge": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Challenge",
      "type": "object",
      "description": "Describes a specific challenge encountered during operations for a given report.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Challenge entity."
        },
        "reportId": {
          "type": "string",
          "description": "Reference to the parent Report. (Relationship: Report 1:N Challenge)"
        },
        "description": {
          "type": "string",
          "description": "The detailed description of the challenge."
        }
      },
      "required": [
        "id",
        "reportId",
        "description"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Provides a recommendation or proposed solution to address challenges or improve operations for a given report.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recommendation entity."
        },
        "reportId": {
          "type": "string",
          "description": "Reference to the parent Report. (Relationship: Report 1:N Recommendation)"
        },
        "description": {
          "type": "string",
          "description": "The detailed description of the recommendation."
        }
      },
      "required": [
        "id",
        "reportId",
        "description"
      ]
    },
    "OtherActivity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OtherActivity",
      "type": "object",
      "description": "Captures miscellaneous activities or incidents not directly part of standard operational reports, for a given report.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OtherActivity entity."
        },
        "reportId": {
          "type": "string",
          "description": "Reference to the parent Report. (Relationship: Report 1:N OtherActivity)"
        },
        "description": {
          "type": "string",
          "description": "The detailed description of the other activity."
        }
      },
      "required": [
        "id",
        "reportId",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/companies/{companyId}",
        "definition": {
          "entityName": "Company",
          "schema": {
            "$ref": "#/backend/entities/Company"
          },
          "description": "Collection for organizational companies. Generally read-only for authenticated users, writeable by administrators.",
          "params": [
            {
              "name": "companyId",
              "description": "Unique identifier for the Company."
            }
          ]
        }
      },
      {
        "path": "/unitTypes/{unitTypeId}",
        "definition": {
          "entityName": "UnitType",
          "schema": {
            "$ref": "#/backend/entities/UnitType"
          },
          "description": "Collection for defining types of operational units (e.g., DPU, SIF). Generally read-only for authenticated users, writeable by administrators.",
          "params": [
            {
              "name": "unitTypeId",
              "description": "Unique identifier for the UnitType."
            }
          ]
        }
      },
      {
        "path": "/operationalUnits/{operationalUnitId}",
        "definition": {
          "entityName": "OperationalUnit",
          "schema": {
            "$ref": "#/backend/entities/OperationalUnit"
          },
          "description": "Collection for specific operational units (e.g., Gasabo DPU). Generally read-only for authenticated users, writeable by administrators.",
          "params": [
            {
              "name": "operationalUnitId",
              "description": "Unique identifier for the OperationalUnit."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Main collection for daily, weekly, or custom period reports. Each document includes 'creatorUid' for ownership-based authorization. Queryable by 'creatorUid' for listing.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier for the Report."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}/companyOperationReports/{companyOperationReportId}",
        "definition": {
          "entityName": "CompanyOperationReport",
          "schema": {
            "$ref": "#/backend/entities/CompanyOperationReport"
          },
          "description": "Subcollection detailing operations by a specific company within an operational unit for a given report. Includes denormalized 'reportCreatorUid' for authorization independence.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier of the parent Report."
            },
            {
              "name": "companyOperationReportId",
              "description": "Unique identifier for the CompanyOperationReport."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}/companyOperationReports/{companyOperationReportId}/caseReportSummaries/{caseReportSummaryId}",
        "definition": {
          "entityName": "CaseReportSummary",
          "schema": {
            "$ref": "#/backend/entities/CaseReportSummary"
          },
          "description": "Subcollection summarizing cases reported at a specific post within a CompanyOperationReport. Includes denormalized 'reportCreatorUid' for authorization independence.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier of the root Report."
            },
            {
              "name": "companyOperationReportId",
              "description": "Unique identifier of the parent CompanyOperationReport."
            },
            {
              "name": "caseReportSummaryId",
              "description": "Unique identifier for the CaseReportSummary."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}/companyOperationReports/{companyOperationReportId}/caseReportSummaries/{caseReportSummaryId}/caseTypeCounts/{caseTypeCountId}",
        "definition": {
          "entityName": "CaseTypeCount",
          "schema": {
            "$ref": "#/backend/entities/CaseTypeCount"
          },
          "description": "Subcollection detailing specific case types and counts within a CaseReportSummary. Includes denormalized 'reportCreatorUid' for authorization independence.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier of the root Report."
            },
            {
              "name": "companyOperationReportId",
              "description": "Unique identifier of the CompanyOperationReport parent."
            },
            {
              "name": "caseReportSummaryId",
              "description": "Unique identifier of the parent CaseReportSummary."
            },
            {
              "name": "caseTypeCountId",
              "description": "Unique identifier for the CaseTypeCount."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}/challenges/{challengeId}",
        "definition": {
          "entityName": "Challenge",
          "schema": {
            "$ref": "#/backend/entities/Challenge"
          },
          "description": "Subcollection for challenges encountered during operations for a given report. Includes denormalized 'reportCreatorUid' for authorization independence.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier of the parent Report."
            },
            {
              "name": "challengeId",
              "description": "Unique identifier for the Challenge."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Subcollection for recommendations to address challenges or improve operations for a given report. Includes denormalized 'reportCreatorUid' for authorization independence.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier of the parent Report."
            },
            {
              "name": "recommendationId",
              "description": "Unique identifier for the Recommendation."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}/otherActivities/{otherActivityId}",
        "definition": {
          "entityName": "OtherActivity",
          "schema": {
            "$ref": "#/backend/entities/OtherActivity"
          },
          "description": "Subcollection for miscellaneous activities or incidents for a given report. Includes denormalized 'reportCreatorUid' for authorization independence.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier of the parent Report."
            },
            {
              "name": "otherActivityId",
              "description": "Unique identifier for the OtherActivity."
            }
          ]
        }
      },
      {
        "path": "/adminRoles/{uid}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection for Database-Backed Access Control. An empty document with a user's UID as its ID grants administrative privileges. (Note: 'User' schema is a placeholder as no specific adminRole schema was provided, but the presence of the document is key).",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase Authentication UID of the user with administrative privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed following the core principles of Authorization Independence, Structural Segregation, and consistent Access Modeling to ensure security, scalability, and debuggability. All entities are mapped to distinct collections or subcollections with clear, semantic paths. \n\n**Authorization Independence:** This is achieved by denormalizing the `creatorUid` from the root `Report` document into all its subcollection documents (e.g., `CompanyOperationReport`, `Challenge`, `Recommendation`, `OtherActivity`, `CaseReportSummary`, `CaseTypeCount`). Specifically, each sub-document will include a `reportCreatorUid` field, holding the `uid` of the user who created the main report. This critical denormalization eliminates the need for `get()` calls in security rules to check parent document permissions. Rules for any document in the report hierarchy can directly verify `request.auth.uid == resource.data.reportCreatorUid`, thus enabling atomic operations and making rules simple, robust, and easily debuggable.\n\n**Structural Segregation and QAPs (Queryable Access Patterns):**\n1.  **Static/Lookup Data:** Collections like `/companies`, `/unitTypes`, and `/operationalUnits` are top-level. They have a homogeneous security posture, likely read-only for most authenticated users and writeable only by administrators (whose UIDs are in the `/adminRoles` collection). This allows simple `list` queries without filtering issues, e.g., `allow list: if request.auth != null;`.\n2.  **Report Data Hierarchy:** The core reporting data begins with `/reports/{reportId}`. All related components, such as `companyOperationReports`, `challenges`, `recommendations`, and `otherActivities`, are structured as subcollections of the `Report`. This hierarchical structure naturally groups related data, ensuring a consistent security posture for all parts of a given report. Queries to list reports (`/reports`) can use `where('creatorUid', '==', request.auth.uid)` to retrieve only reports created by the requesting user. The security rules will enforce this ownership check for `list` operations, supporting QAPs. For `get`, `update`, and `delete` operations on any document within a report's hierarchy, the denormalized `reportCreatorUid` field allows direct verification against `request.auth.uid`, ensuring that rules are not used as filters and all retrieved data is authorized.\n3.  **DBAC (Database-Backed Access Control):** A dedicated `/adminRoles/{uid}` collection is used. The mere existence of a document with a user's `uid` as its ID in this collection grants administrative privileges, allowing rules to check `exists(/databases/$(database)/documents/adminRoles/$(request.auth.uid))` for admin authorization.\n\nThis design prioritizes explicit ownership, avoids complex `get()` dependencies, and provides clear access patterns suitable for secure and performant Firestore applications."
  }
}